# Объяснение задач по исправлению (человеческим языком)

Этот документ объясняет, что именно изменится в проекте при применении каждой задачи, простыми словами без технических деталей.

---

## TASK 1 — Rate Limiting (защита от спама)

**Что сейчас:**
Защита от спама не работает в продакшене, потому что счетчики хранятся в памяти и сбрасываются при каждом запуске функции.

**Что изменится:**
Защита будет работать через внешнее хранилище (Redis), где счетчики сохраняются между запусками.

**Результат:**
Защита от спама работает, нельзя обойти ограничения.

---

## TASK 2 — HTML Injection (безопасность сообщений)

**Что сейчас:**
Пользовательский текст отправляется в Telegram как HTML без экранирования. Можно сломать форматирование или вставить вредоносный HTML.

**Что изменится:**
Весь пользовательский текст будет экранироваться перед отправкой в Telegram.

**Результат:**
Сообщения безопасны, форматирование не ломается.

---

## TASK 3 — Валидация видео (защита от больших файлов)

**Что сейчас:**
Можно загрузить видео любого размера и типа, что может перегрузить сервер.

**Что изменится:**
Будут проверки: размер файла (максимум 50 МБ), тип файла (только видео), имя файла (безопасное).

**Результат:**
Защита от перегрузки сервера большими файлами.

---

## TASK 4 — IP-адреса (точная идентификация)

**Что сейчас:**
IP-адрес берется из заголовка, который легко подделать. Из-за этого защита от спама не работает.

**Что изменится:**
IP будет извлекаться из надежных заголовков Netlify и валидироваться (проверяться на корректность).

**Результат:**
Защита от спама работает правильно, аналитика по IP точнее.

---

## TASK 5 — Error Boundaries (защита от падений)

**Что сейчас:**
Если в компоненте происходит ошибка, падает вся страница и пользователь видит белый экран.

**Что изменится:**
Ошибка будет ловиться, показываться понятное сообщение и кнопка "Попробовать снова". Остальная страница продолжит работать.

**Результат:**
Лучший пользовательский опыт, страница не падает полностью.

---

## TASK 6 — Проверка переменных окружения (раннее обнаружение проблем)

**Что сейчас:**
Если не хватает переменных окружения (например, токен Telegram), ошибка появляется только когда пользователь пытается отправить заказ. Непонятно, что не так.

**Что изменится:**
При старте приложения будет проверка всех нужных переменных. Если чего-то нет — приложение не запустится с понятной ошибкой.

**Результат:**
Проблемы видны сразу, проще отлаживать.

---
---




---

## TASK 10 — Валидация форм (Zod)

**Что сейчас:**
Валидация делается вручную в разных местах: проверка телефона здесь, проверка адреса там. Легко пропустить ошибку или сделать по-разному.

**Что изменится:**
Установится библиотека Zod, которая позволяет описать правила валидации один раз. Все формы будут использовать эти правила.

**Результат:**
Единообразная валидация, меньше ошибок, проще добавлять новые проверки.

---

## TASK 11 — Prettier, Husky, lint-staged (автоматизация качества)

**Что сейчас:**
Нет единых стандартов форматирования кода. Каждый форматирует как хочет. Нет проверки перед коммитом.

**Что изменится:**
- Prettier будет автоматически форматировать весь код одинаково
- Husky будет запускать проверки перед каждым коммитом
- lint-staged будет проверять только измененные файлы

**Результат:**
Весь код выглядит одинаково, ошибки ловятся до коммита, меньше проблем в PR.

---

## TASK 12 — Тесты (проверка работоспособности)

**Что сейчас:**
Нет тестов вообще. Непонятно, работает ли код после изменений.

**Что изменится:**
Установятся инструменты для тестирования (Vitest, React Testing Library, Playwright). Будут написаны тесты для:
- Формы заказа (валидация, отправка)
- API для Telegram (отправка сообщений)
- Rate limiting (защита от спама)
- QR-верификация (сканирование, запись видео)

**Результат:**
Уверенность, что код работает. Изменения не ломают существующий функционал.

---

## Приоритеты

**Критично (сделать в первую очередь):**
- TASK 1 — Rate Limiting (безопасность)
- TASK 2 — HTML Injection (безопасность)
- TASK 3 — Валидация видео (безопасность)
- TASK 4 — IP-адреса (безопасность)
- TASK 6 — Проверка env переменных (стабильность)

**Важно (сделать во вторую очередь):**
- TASK 5 — Error Boundaries (UX)
- TASK 7 — Рефакторинг (поддерживаемость)
- TASK 10 — Валидация форм (качество)

**Желательно (можно сделать позже):**
- TASK 11 — Prettier/Husky (качество кода)
- TASK 12 — Тесты (надежность)

---

## Как применять

Скажи мне:
- **"Cursor, apply fix for TASK 1"** — применю исправление для задачи 1
- **"Cursor, implement only TASK 4"** — реализую только задачу 4
- **"Cursor, show me code changes for TASK 6 before applying"** — покажу изменения перед применением

Я буду применять изменения по одной задаче за раз, чтобы ты мог проверить каждое исправление.

